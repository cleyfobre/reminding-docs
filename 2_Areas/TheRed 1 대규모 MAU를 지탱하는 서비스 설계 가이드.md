#fastcampus #mau #msa #architecture #data #thered

> [!note]
> 이 문서는 패스트캠퍼스 강의인 _# The Red : 4천만 MAU를 지탱하는 서비스 설계와 데이터 처리 기술 By 카카오페이지 기술전략이사 윤진석_ 을 요약한 것이다.

#### 웹의 등장
_웹(Web)_ 은 1998년 즈음 등장하였다. 간단한 전자문서의 형태였다. 오늘날의 웹사이트는 2006년 즈음부터 생겨났다. 정보를 얻고, 댓글을 쓰고, 상호작용하는 등의 소셜미디어로 발전한 형태를 말한다. 2010년 즈음에는 본격적으로 무선 인터넷 및 모바일 시대가 열렸다.

#### 기술 주도의 중요성
구글에서 있던 일이다. 서비스를 개발하는 팀들은 다양한 기기들을 필요로 한다. 인프라 팀은 그들의 요구를 들어준다. 

_"우분투 20.04 환경을 설치해주세요. 포트 20에 SSH 열어주세요."_

인프라팀은 늘 '을'이었다. 하지만 이들은 인프라를 공급하는 프로세스를 쉽게 할 수 있도록 개선하여 오늘날의 클라우드 서비스를 제공하였다. 그리고 그들은 '갑'의 위치에 설 수 있게 되었다. 기술 주도 성장의 아주 좋은 예라고 할 수 있다.

> [!danger] This document includes ...
> 서버 개발자가 반드시 알아야 하는 것들. 펀더멘털적이고, 간과해서는 안되는 것들을 다룬다.

#### 기술부채
서비스에 치명적인 문제를 일으키기 전까지 존재하는 모든 안좋은 코드들을 말한다. 기술부채는 임직원들의 안좋은 기술경험, 스트레스, 제품의 품질 저하 등으로 이어지며, 이는 잦은 퇴사, 낮은 기업 평판, 고객들에게 안 좋은 경험 제공 그리고 비즈니스 문제 등으로 이어진다. 아래와 같은 말들을 자주 듣게 된다면, 기술 부채의 위험을 나타낸다.

> ?? : _그 기능은 Adam이 출근해야 됩니다._
> ?? : _그 쿼리 건드리면 무조건 장애가 납니다._
> ?? : _서비스에서는 티가 잘 안 나니 일단 적용할까요?_

기술부채 중에서 유명한 것이 ==절망의 쿼리(THE QUERY OF DESPAIR)== 이다. 하나의 기능을 하는 쿼리가 6페이지 씩이나 되는 아래의 사진을 보자. 

![[Pasted image 20231207163317.png|400]]

위와 같은 상황은 왜 생길까? 이러한 상황은 흔한 비즈니스의 요구 상황에도 충분히 나올 수 있다. 예를 들어, 숙박 어플리케이션 여기어때의 개발자 Eddy가 아래와 같은 요구사항에 직면했다. 

> "관리 툴에서 지난 4년간 매출을 월 단위로 볼 수 있게 해주세요!"

Eddy는 아래와 같이 쿼리를 작성했다. 

```mysql
select 
	date_format(date, '%M-%Y') as sdate,
	sum(payment) as netsales
from reservation
where year(sdate) > year('2019-01-01')
group by year(sdate), month(sdate)
order by year(sdate), month(sdate)
```

집계를 내야하기 때문에 date, payment 컬럼을 Full Scan 해야 한다. 4년 간의 데이터는 무려 1억 5천 건의 데이터이다. payment 컬럼의 크기는 4bytes, date 컬럼의 크기는 10bytes라고 한다면, 공간복잡도와 시간복잡도는 아래와 같다.

- 공간복잡도:
$$ 15 \times 10^7 \times (4bytes + 10bytes) = 2GB$$
- 시간복잡도:
$$O(NM) + O(KlogK)$$

데이터베이스 서버가 충분히 성능이 좋고, 최적화가 되어 있다면 모르겠으나, 필요로 하는 2GB의 용량과 집계 연산 등을 고려하면 쿼리가 1초 이내로 떨어지기가 어렵다. 그래서 해결 방안으로서 _이 쿼리를 새벽 배치로 실행시켜 결과값만 새로운 테이블에 저장_ 하여 가져오는 방법을 생각해냈다.

그러나,

> [!danger] 배치 쿼리가 도는 동안, 이런 일이 발생한다면?
> 고객에 의한 결제 취소, 재결제 등의 Delete or Update 연산 처리가 동시에 일어나고 있다면?
> 
> 단순 DB Lock 장애나 데이터 및 집계 정합성 문제 뿐만이 아니다. 해당 테이블을 여러 비즈니스 로직에서 사용을 하고 있거나, 내가 만든 이 쿼리가 과거 개발자들이 이미 여러개를 만들어 놓았다면, 이또한 기술부채의 증가를 의미한다. 

#### 이와 같은 문제 해결을 위해 필요한 역량

| 문제 | 원인 |
| -------- | -------- |
| 서비스 장애와 성능 이슈 | ==알고리즘과 자료구조 역량== |
| 트래픽 대응 및 유지보수의 어려움 | ==확장성 있는 설계와 소프트웨어 디자인 역량== |
| 제품 품질을 위한 메뉴얼 운영 인력의 증가 | 사람 대신 기계, 데이터 활용 역량 |

결과적으로 알고리즘과 자료구조의 역량이 시스템 안정성과 성능을 높인다. 확장성 있는 설계를 할 줄 알고, 소프트웨어 디자인 역량이 있어야 트래픽 대응을 할 수 있으며 유지보수를 잘 할 수 있다. 해당 내용에 관한 가이드 라인은 [[TheRed 2 확장성 있는 아키텍쳐 설계 가이드]] 에서 확인하자.




