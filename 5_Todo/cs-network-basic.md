## network basic

### ref: http://www.kmooc.kr/courses/course-v1:SKKUk+SKKU_26+2022_T1/about

### 0. 기본 개념

- LAN은 Local Area Network의 줄임 말로서, 집, 사무실 혹은 빌딩 내에서 통신이 가능한 네트워크를 말하며 보통 내부망이라고도 한다. 
- 흔히 집에서 LAN선을 연결한다고 하거나, 와이파이를 연결하는 행위를 곧 인터넷을 하는 행위라고 생각하지만 그렇지 않다.
- 해당 행위들은 LAN으로의 접속을 의미하고 LAN의 라우터 혹은 모뎀이 ISP(인터넷 제공 업체)에 연결됨으로써 인터넷이 가능한 것이다.
- 

### 1-1. 네트워크 개요

- 네트워크란?
  - 여러 노드들이 여러 통신링크로 연결된 덩어리 자체를 의미한다.
  - 노드란 PC, 서버, 라우터, 스위치 등의 장치들을 의미한다.
  - 링크란 유선, 무선 등이 있다.

- 좋은 네트워크란?
  - 성능(Performance): 처리량(Throughput)과 지연시간(Delay)
  - 신뢰(Reliability): 장애빈도, 장애발생 후 회복시간, 견고성 등
  - 보안(Security)

- 링크의 연결 형태
  - 일대일: 오직 일대일로만 연결
    - 예) 내 컴퓨터와 연결된 프린터
  - 멀티포인트(or 멀티드롭): 하나의 연결이 여러 노드에 연결

- 네트워크 토폴로지: "노드와 링크가 어떻게 배치되어 있는가"를 의미
  - 토폴로지는 일반적으로 4가지가 있다. 스타, 버스, 링, 매시 등
  - 스타 형(Star): 각 장치가 중앙장치(Hub)에 일대일 연결되어 통신하는 형태
  - 버스 형(Bus): 하나의 케이블에 여러 장치들이 연결되어 각 신호가 전체에 전달되는 형태
  - 링 형(Ring): 장치들이 링 형태로 서로 연결되어 데이터가 링을 따라 한쪽 방향으로 전달
  - 그물 형(Mesh): 각 장치가 일대일로 연결되어 서로가 일대일 통신하는 형태
  - 일반적인 조직에서는 위의 4가지 네트워크 토폴로지가 다 존재하는 형태다.

- 네트워크 분류
  - LAN(Local Area Network): 보통 한 사무실, 건물, 캠퍼스 등에서 장치들이 서로 연결되며, 개인적으로 소유 가능
  - MAN(Metropolitan Area Network): 도시 정도의 크기를 포함하는 규모
  - WAN(World Area Network): 지역적으로 넓은 범위에서 데이터를 전송하기 위해 구성. 여러 네트워크가 연결되는 경우를 인터넷이라 함. 즉, 인터넷은 네트워크가 서로 연결된 전체 네트워크를 의미하고 규모적인 면에서 WAN에 속한다.

### 1-2. 네트워크 모델과 표준 프로토콜

- 계층화의 개념
  - 네트워크 책에선 계층화라는 것이 항상 나오는데, 그것을 왜 해야하는지 이해해야할 필요가 있다.
  - 사람간 대화도 생각 >> 언어 >> 입과 귀 등을 거쳐 대화를 한다. 즉 계층화가 되어 있다. 내가 만약 귀가 안들리면 보청기를 끼면 된다. 보청기를 낀다고 해서 나의 생각과 언어에 영향을 미치지 않는다. 
  - 마찬가지로 네트워크에도 계층화가 되어 있는데, 통신 과정에 있어서 각 계층을 거치게 되어 있고, 각 계층이 변하더라도 서로 다른 계층에 영향을 미치지 않는다.

- TCP/IP 모델(인터넷 모델이라고도 함/5계층): 인터넷의 출현 이후에는 OSI 7계층은 거의 사용하지 않는다.
  - Application(응용): HTTP나 FTP 등.
  - Transport(수송): 프로세스 to 프로세스. 메시지를 세그먼트 단위로 분할 및 조립.
  - Network(네트워크): 호스트 to 호스트. 패킷을 최종 목적지로 경로 설정함. (=라우팅)
  - Data Link(데이터링크): 물리 계층과 다르게 메시지의 형태를 가짐. 에러 제어가 가능.
  - Physical(물리): 물리 계층. 0과 1의 비트들의 나열로 보고 데이터를 그냥 보내는 계층.

- 표준 프로토콜
  - 데이터를 주고 받는데 이용되는 규칙의 집합
  - De jure: 표준화를 제정하는 기구가 공식적으로 규정된 표준
  - De facto: 이미 많이 이용되고 있어서 사실상 표준

### 2-1. 스위칭 방법과 종류

- 스위칭의 개념
  - 노드와 노드 사이에 링크가 있는데 그것을 임시로 연결해주는 것을 말함.

- 스위칭의 필요성
  - 노드가 여러개면 링크가 더 늘어나기 때문에 돈이 많이 듦.
    - link 갯수 = n(n-1)/2
  - 링크 대다수는 유휴시간이 많음.
  - 이러한 문제를 해결하기 위해 여러 노드가 스위치에 연결되도록 구성

- 스위칭의 종류
  - 회선(Circuit) 교환: 선을 연결하는 방식(기차 레일 필요할 때마다 바뀌는 것처럼)
    - 전화망(PSTN)에서 사용. 전화상에선 서로 말(데이터)을 주고받지 않아도 요금이 나감. 두 사람(노드)말곤 아무도 그 선을 사용할 수 없기 때문.
  - 메시지 교환: 전달할 메시지를 수신하면 인접 노드로 전달.(Store and forward)
    - 메시지 용량이 10GB면 그걸 다 저장해야하는 메모리가 필요.
  - 패킷 교환: 노드가 저장할 수 있는 작은 단위(패킷)로 나눠서 전송. 데이터를 쪼개다보니까 패킷마다 데이터의 순서를 적어놓을 필요가 있음(헤더의 존재 이유)
    - 군집성있는(bursty) 트래픽 전송에 적합
    - 패킷 교환은 데이터그램과 가상회선 방식 두가지로 나뉨.
    - 데이터그램 방식: 그냥 일단 패킷으로 쪼개서 순서와 상관없이 가능한 링크를 통해서 보냄. (패킷이 각자 다른 링크를 통해서 갈 수 있음) 그래서 목적지에선 패킷 순서가 뒤죽박죽일 순 있음. 그러나 가장 효율적인 방식임(놀고 있는 링크를 줄이는 것이니까.)
    - 가상회선 방식: 데이터를 보내기 전에 연결 설정. 동일한 경로로 순서대로 목적지에 도착.
    - 데이터그램 방식과 가상회선 방식을 섞을 수 있음. 데이터 그램 방식에서는 순서 상관없이 최대한의 효율을 높여서 가는 건데, 가상회선을 만들어서 보낼 수도 있음. 그래서 이렇게 보내면 엄밀하게 데이터그램 방식은 아님. 이렇게 쓰는 걸 MPLS라고 함.

- MPLS(Multi Protocol Label Switching)
  - 속도 때문에 데이터그램 방식과 가상회선 방식을 섞어서 씀. 데이터그램은 노드마다 어떤 링크를 타야하나 정해야하기 때문에 시간이 걸림. 가상회선 방식처럼 레이블을 붙여 놓으면 바로바로 링크를 탈 수 있어서 속도가 빠름.
  - 우리가 사용하는 인터넷은 MPLS를 많이 활용함.

### 2-2. 다중 접속(MA, Multiple Access)

- 다중 접속의 개념
  - 친구 간의 대화에도 서로 말이 겹치면 조정이 필요함. 누군가가 말하고 다른 누군가는 들어야 함. 이렇듯 컴퓨터도 여러 컴퓨터가 동시에 하나의 매체에 접근할 때 문제가 생기곤 하는데, 이를 다중 접속이라 함.
  - 데이터링크 계층에서 수행
    - 상위 부계층은 데이터 링크를 제어
    - 하위 부계층은 공유 매체의 접근 문제를 해결

- 다중 접속 프로토콜 종류
  - 무작위 접근(Random Access)
    - 어떤 시스템이 전송할 차례인지 규칙이 없음. 그냥 경쟁(Contention)임.
    - 그래서 충돌(Collision)도 일어날 수 있음.
    - 첨에 무작위 접근을 사용하다가 CSMA라는 것도 만들어지고.
    - 유선이면 CSMA/CD 무선이면 CDMA/CA 등으로 발전도 함.
    - 이것들의 시작은 ALOHA 프로토콜임.(하와이대학교에서 처음 개발됨.)
  - 통제된 접근(Controlled Access)
    - 하나의 시스템이 제어국이 되어 다른 시스템들의 전송 권한을 제어

- 무작위 접근

  - ALOHA
    - 중간에 기지국을 두고 컴퓨터들이 안테나를 달아 기지국에 데이터를 쏨.
    - 여기저기서 쏘니까 Collision이 발생함. 그래서 컴퓨터는 수신자로부터 ACK를 받도록 함. ACK를 받으면 잘 받았음을 알 수 있음.
    - 근데 ACK를 하염없이 기다리는 문제도 생기게 됨.

  - CSMA (Carrier Sense Multiple Access)
    - 그래서 데이터 송신 전에 미리 감지해보기로 함.
    (= Sense before transmit / Listen before talk)
    - 데이터를 보내기 전에 누가 데이터를 보내나 안보내나 감지해본다.
    (= Carrier Frequency가 잡히나 안잡히나 Sensing 해본다.)
    - 그래서 아무도 안보내면 데이터를 보낸다. 근데 이렇게 해도 충돌이 난다.
    - 왜? 음속 때문일 수 있음. 그 찰나에 주파수가 안잡혔을 수도 있음. 센싱할 땐 없다가도 데이터를 보낼 때 갑자기 어디선가 데이터를 보낼 수도 있기 때문.

  - CSMA/CD
    - CSMA에 충돌 감지(Collision Detection)를 추가함. 데이터 보내고 나서 데이터가 깨지는지 안 깨지는지 확인.
    - 혹시라도 깨지면 데이터 전송을 중지하여 채널 사용하지 않도록 만들고, 나중에 다시 보냄

  - CSMA/CA
    - 근데 위 방식은 무선에선 사용하기 어려움. 그래서 충돌을 최대한 피하는 방법을 씀.(Collision Avoidance). 물론 충돌을 완전 피할 순 없음. 최대한 피하자는 의미.
    - IFS라고해서 채널이 비어있으면 바로 데이터를 안보내고 잠시 쉼.
    - 또 Centention Window라고해서, 임의의 수만큼 쉼. 
    - 마지막 ACK받는것까지 하면 CSMA/CA의 방식임.

- 통제된 접근
  - 예약: 예약된 사람만 데이터 보낼 수 있음.
  - 폴링: 데이터 있냐고 먼저 물어보고, 보낼거 있다고 하면 데이터 보내게 해줌.
  - 토큰 전달: 토큰 있는 사람만 데이터 보낼 수 있음.

- 채널화
  - 공기든 선이든 나눠서 쓰는 걸 말함.
  - 주파수를 나눠서 사용하면 FDMA라고 하고, (Frequency Division)
  - 시간을 나눠서 사용하면 TDMA라고 함. (Time Division)
  - 코드를 나눠서 사용하면 CDMA라고 함. (Code Division)

### 3-1. LAN(Local Area Network)에서 사용하는 매체

- 매체의 개념
  - 데이터는 송신자와 수신자 사이에서 움직이는데, 이런 데이터를 전달해주는 무언가를 통틀어서 매체라고 함.
  - 매체 (= 전송매체, Transmission media)

- 매체의 구분
  - 선이 있는 매체: 유선 (혹은 유도체, 유도매체, Guided media)
    - 컴퓨터와 프린터 사이에 연결된 케이블선은 데이터가 케이블선이 유도하는 방향대로 움직임.
    - 예: 꼬임선(Twisted-apir cable), 동축케이블(Coaxial cable), 
    광케이블(광섬유케이블, fiber-opti cable) 등
  - 선이 없는 매체: 무선 (혹은 비유도체, 비유도매체, Unguided media)
    - 사람이 공기중에 말하면 그 주변 사람들은 누구나 들을 수 있음. 데이터가 어느 유도된 방향대로 움직이지 않음.
    - 예: 공기

- 유도매체
  - 꼬임선(Twisted-pair cable, 'TP케이블' 구글 이미지 검색 고)
    - 안 쪽이 두갈래로 배배꼬여있음.
    - 보통 랜선 안에 이런식으로 되어 있음.
    - UTP(Unshielded TP): 쉴드가 안쳐저 있다. 즉, 위부 잡음으로부터 막아주도록 차폐되어 있지 않으면 UTP.
    - STP(Shielded TP): 쉴드가 쳐저 있으면 STP.
    - 원래 차폐시키는 공정이 더 들어가니까 STP가 비쌌는데, 요즘엔 UTP도 많이 좋아지고 원래 더 싸니까 많이 쓴다고 함.
    - UTP 카테고리: 그냥 품질 카테고리가 있는데, UTP선 겉에 쓰여져 있다고 함. 품질이 좋다는 건 지원속도와 사용 환경의 차이를 나타냄.
    - TP 커넥터: UTP 케이블을 컴퓨터나 통신장치, 네트워크 장치에 연결하려면 커넥터가 필요함. 흔히 랜선에서 가장 많이 쓰는게 RJ(Registered Jack)45이고, 구글 이미지 검색 고. (랜선 대가리 부분을 말함.)
  - 동축 케이블(Coaxial cable)
    - 요즘은 다 집에서 IPTV 보는데 예전에 케이블 TV 시절에는 다 동축 케이블이 연결되어 있었음. 
    - TP보다 주파수를 수용하는 용량이 커서 고속으로 신호를 전송할 순 있었는데, 거리가 멀수록 신호의 감쇄가 심해지는 단점이 있음. 그래서 광케이블로 많이 넘어간 상태임.
    - 요즘엔 UTP나 광케이블 등을 많이 쓰지 동축은 거의 안씀. LAN을 사용하는 통신 형태에서는 보기가 힘듦.
  - 광케이블
    - UTP, STP, 동축 처럼 전기적 신호를 사용하는게 아니라, 빛이라는 신호를 사용해서 열도 안나고 잡음에도 덜 민감하고 속도도 빠름. 외부로부터 침입도 어려움. 
    - 대신 연결이 어렵고, 비쌈.
    - 광케이블은 코어가 있고, 그 주변에 클레딩으로 감싸져 있는데, 코어에 빛을 쏘면 그것이 클레딩에 계속 튕겨져 나가면서 목적지까지 전달됨.
    - SC 커넥터, ST커넥터, RJ-45커넥터 같이 생긴 MT-RJ 등등 종류가 있음.

- 비유도매체
  - 공기에다가 주파수를 쏨.
  - 주파수가 높을 수록, 직진성이 강해짐
  - 주파수가 낮을 수록, 직진성이 약해짐
  - 라디오파(Radio Wave)는 주파수가 낮아 직진성이 약하여 다방향성으로 흩어짐.
  - 마이크로파(Micro Wave)는 주파수가 높고 직진성이 강해서 데이터를 서로 주고받는데 사용됨.

### 3-2. 유선 LAN의 표준, 이더넷(Ethernet)

- 이더넷
  - 이더넷은 예전에 복사기 만드는 Xerox라는 회사의 한 연구원이 사내용으로 만들었던 네트워크였는데 이게 나중에 미국 전역에서 쓰고자 인텔, DE 와 협업을 해서 완성을 시키고, ISO에서 표준화로 지정하게 되어 지금까지도 사용중이다.
  - 이더넷은 매체를 공유하는 환경에서 어떻게 데이터를 보낼까?라는 고민에서 시작됨.
  - 데이터링크 계층에서는 LLC와 MAC 두 계층으로 나뉨.
  - IEEE에선 옛날에 만들어진 이더넷을 개선 시킬 필요성을 느껴서 표준을 연구하는 위원회(워킹그룹)를 따로 두게됨. 보통 워킹그룹의 이름은 802.3z, 802.2 이런식으로 정해졌는데 해당 그룹에서 만든 프로토콜의 이름과 동의어처럼 쓰이기도 함. 예를 들어, 아까 언급한 LLC는 IEEE 802.2라고도 하고, CSMA/CD 프로토콜은 IEEE 802.3라고 해도 됨. 동의어임.
  - 이더넷의 속도는 맨 처음 10Mbps에서 10Gbps까지 발전.
  - 이더넷 프레임 (MAC 프레임)
    - 7개의 필드로 구성.
    - Preamble, SFD, DA, SA, Length/Type, Data, CRC
      - Preable: 프레임이 곧 도착하니 준비해라
      - SFD: Start Frame Delimiter, 프레임의 시작을 알림
      - DA: Destination Address 목적지 주소
      - SA: Source Address 송신자 주소
      - Length/Type: 데이터 필드의 길이나 네트워크 계층 프로토콜의 종류
      - Data: 최소 46byte에서 최대 1500byte까지의 데이터
      - CRC: 에러를 검출하는 기능
  - 주소 지정
    - 각 시스템엔 NiC(혹은 LAN 카드라고도 불림)이 있는데, LAN 카드에는 고유 주소가 있음. 보통 MAC주소, 이더넷주소, 하드웨어 주소 등으로 불림.
    - 총 6byte의 형태임.(ex. 60:01:02:01:2C:4B)
  - MAC 프로토콜: CSMA/CD
    - 이더넷은 1-persitent CSMA/CD를 사용. 누군가 데이터를 보내고 있으면 그걸 다 듣고 있다가 송신이 끝나면 데이터를 보냄.


### 4-1. 무선 LAN

- 무선 LAN 구조
  - AP(Access Point)를 유무선공유기라고도 함.
    - 우리가 흔히 집과 사무실에서 쓰는 와이파이 공유기가 AP임.
  - BSS(Basic Service Set)
    - Infrastructure 모드: 중간에 AP를 두고 무선 통신하는 방법
    - Ad hoc 모드: AP같은 매개체 없이 직접 무선 통신하는 방법
  - ESS(Extended Service Set)
    - AP를 갖는 여러 BSS로 구성된 서비스

- MAC 부계층
  - 무선 LAN에서는 MAC이 또 두 영역으로 나뉘는데 하나는 DCF, 다른 하나는 PCF임. DCF는 꼭 써야하고 PCF는 써도 되고 안써도 된다. 그래서 유선에서 MAC이라고 부르는 건 무선에선 DCF라고 한다.
  - 데이터링크 계층에서 LLC는 유선에서든 무선에서든 공통적으로 쓰는 거고, 유선에선 MAC이라고 하는걸 무선에선 DCF다. 근데 DCF와 선택적으로 사용하는 PCF도 있다고 이해하면 됨.
  - PCF(Point Coordination Function): Contention이 없기에 Collision이 없음. Contention이 없으려면 중재를 해주는 AP의 존재가 필수적임. 그래서 PCF는 Ad Hoc 모드에서는 쓸 수가 없음.
    - 폴링 방식을 씀. "나한테 데이터 보낼 거 있는 분?"이라는 메시지를 보내고, 데이터 보내는 누군가가 있다면 데이터를 받음.
  - DCF(Distributed Coordination Function): CSMA/CA를 사용. CA는 Collision Avoidance이나 완전 Collision Free(충돌이 아예 없음)를 의미하는게 아님. 충돌이 나긴 남. 그렇다면 왜 충돌을 못피할까?
    - Hidden Terminal 문제
      - A, B, C가 차례로 컴퓨터가 있다고 한다면.. 셋 모두 Carrier Sensing을 하겠지만, A는 C를 Sensing하지 못하고, C는 A를 Sensing하지 못하여 데이터를 쐈을 때, B는 양쪽으로부터 오는 데이터의 충돌을 경험하며 이 문제를 Hidden Terminal이라고 함.
      - 이를 해결하기 위해 나온 것이 RTS(Request To Send), CTS(Clear To Send). A는 B에게 "나 데이터 보낼 것이 있다."는 의미의 RTS를 보냄. B는 "보내라"는 의미의 CTS를 보냄. 그럼 C는 가만히 있다가 CTS를 받았으니 "아 누군가 데이터를 보내려나보다"라고 생각하여 데이터를 보내는 걸 멈춤. A는 CTS를 받았으니 데이터를 보냄. 그리고 ACK를 기다림.

- Bluetooth (블루투스)
  - 기기 대 기기임. Ad Hoc 네트워크를 사용.
  - WPAN(Wireless Personal Area Network)라고 부름.
  - Piconets
    - 하나는 마스터(Primary)가 되고 나머지는 종속 시스템(Secibdaries or Slaves)으로 구성
    - 마스터와 종속 시스템 사이에는 두가지 형태의 링크가 존재
      - SCO(Synchronous Connection Oriented): 데이터가 끊겨도 됨.(실시간 음성)
      - ACL(Asynchronous Connection Link): 데이터 손실 나면 안됨.

### 4-2. 네트워크 연결 장치

- 네트워킹 장치는 네트워크와 네트워크를 연결하며 계층에 따라 여러가지 존재할 수 있다.
- 네트워크 설계시 가장 중요한게 어떤 네트워크 장치를 쓰느냐이고, 해당 장치가 어떤 의미를 갖는지 이해하는 게 매우 중요함.
  - Application(응용): 게이트웨이
  - Transport(수송): 게이트웨이(L4 스위치가 존재하긴 함)
  - Network(네트워크): 라우터 or 3계층(L3) 스위치
  - Data Link(데이터링크): 브릿지 or 2계층(L2) 스위치
  - Physical(물리): 리피터 or 허브

- 네트워크 장비
  - 리피터: 데이터 신호가 오면 그 신호를 받아서 깨끗하게 반대편으로 전달함. 주로 선을 길게 가겨가기 위함. 데이터가 맞는지 틀린지 검증을 안함.
  - 브릿지: 지금은 많이 안쓰이고 L2스위치를 훨씬 많이 씀. 리피터에서 못한 에러를 검출하는 기능이 있음. 리피팅기능도 가지고 있음.(1, 1계층 다 갖고있다는 의미). MAC 주소를 가지고 필터링하는 기능이 있음.
  - 라우터: IP주소를 기반으로 패킷 전달
  - 스위칭허브: 이더넷 프레임 포맷에 있는 목적지 주소를 보고선 해당 포트로만 메시지를 전달. A가 B로 가는 상황이 발생하면 C가 D로도 동시에 갈 수 있게됨.
  - 게이트웨이: 두 개 이상의 다른 시스템이나 네트워크를 연결하는데 사용

- Backbone Networks
  - 여러 네트워크를 연결하는데 사용되는 네트워크. 여러 LAN들을 백본 장비를 통해 연결시켜줌.

- 가상LAN (Virtual LAN)
  - 물리적 제한없이 논리적 구성에 따라 LAN을 구성.
  - 동일한 VLAN에 속한 구성원들은 같은 LAN에 속해있는 것으로 간주.

### 5-1. 이동전화와 위성네트워크

- 이동 전화
  - 이동 전화는 기지국을 중심으로 서비스 영역을 가진다. 그 서비스 영역을 Cell이라고 한다. 그래서 핸드폰이 영어로 CellPhone임.
  - MSC(Mobile Switching Center): 전화를 걸면 기지국하고 연결되고 또 다른 유선전화나 무선전화로 연결된다. 중간에 연결되는 지점을 MSC라 함. 과금 정보 여기서 관할함.
  - 그래서 사실 내가 폰으로 전화를 한다는건 기지국까지 무선이지 기지국에서 다른 폰까지 수많은 기지국과 MSC를 거칠 땐 다 유선이다.
  - Handoff: 폰이 어느 셀에서 다른 셀로 이동.
    - Hard Handoff: 이전 기지국과 연결을 단절하고 새로운 기지국과 연결
    - Soft Handoff: 단절 전에 새로운 기지국과 연결. 동시에 두 기지국을 연결.
  - 1G
    - 고정된 전화에서 이동하는 전화로. 여전히 아날로그.
    - 아날로그라 잡음신호까지 증폭됨.
    - AMPS(Advanced Mobile Phone System)
  - 2G
    - 최초의 아날로그에서 디지털로 바뀐 전화. 0과 1
    - 예전 아날로그 때는 할 수 없었던 CDMA(Code Devision Multiple Access), GPS, SMS 등 사용. 인터넷 사용.
  - 3G
    - 디지털 데이터와 음성 통신을 위한 설계
    - 음성 품질이 기존 전화망에 견줄만하게 됨.
    - 인터넷 원활해짐.
    - 2Mbps까지 속도가 향상됨.
  - 4G
    - All IP로 디지털 데이터와 음성 통신을 통합
    - 100Mbps의 속도 가능.
    - 인터넷이나 멀티미디어 통신 원할.(PC 인터넷만큼 빨라짐)

- 위성 네트워크
  - GPS나 네비게이션 등에서 사용.
  - 지구 주변에는 Van Allen Belt라고 전하들이 있는 층들이 있는데 전자제품이 여기에 위치해 있으면 고장나기 때문에 위성은 이 층들을 피해서 띄우게 되어 있음. 그러다보니 3개의 층으로 나뉘게 됨.
    - GEO(Geosynchronous Earth Orbit): 35786km 인근
      - 지구 자전 속도만큼 돔.
    - Upper Van Allen Belt: 15000 ~ 35000km
    - MEO(Medium Earth Orbit): 5000 ~ 15000km
      - 6-8시간에 한번 지구를 돌고 GPS 담당.
      - 4개의 위성으로부터 정보를 받아야 계산 가능. "각 위성에서 받은 원형 범위부터 얼마나 떨어져있다"는 정보를 4개를 받으면 정확한 위치가 계산이 됨.
    - Lower Van Allen Belt: 2500 ~ 5000km
    - LEO(Low Earth Orbit): 0 ~ 2500km
      - 음성 통신에 주로 사용(위성 전화)

### 5-2. 인터넷 프로토콜: IP

- 네트워크 프로토콜
  - 연결지향: 데이터 전송 전 반드시 연결 설정
  - 비연결지향: 연결 설정 과정 없이 데이터 그냥 막 보냄.
    - 대표적으로 IP가 비연결지향 프로토콜임.

- IP 패킷
  - IP 그 자체는 비신뢰성, 비연결형 데이터그램 프로토콜임.
  - 데이터를 보내면 보내질 수도 있고 안보내질 수도 있고.
  - 신뢰성이 중요한 전송에서는 TCP와 함께 사용.
  - 형태
    - 버전: IPv4로 IPv6 나뉨
    - 헤더 크기: 헤더 크기가 고정되었다면 이게 필요없을텐데, 헤더에는 option이 붙을 수 있음. option도 정해진 크기가 있는게 아니라 가변적. 그래서 전체 IP 패킷 중에서 어디까지가 헤더고 어디부터가 데이터인지 명시해줌.
    - 서비스: 지연시간, 신뢰성, 처리량 등 어떤 특성을 거려해야할지 명시.
    - 전체 길이
    - TTL(생존시간, Time to live): 통신 장비 거칠 때마다 정해진 TTL이 1씩 줄어듦. 그리고 0이 되면 이 패킷을 버림. 이는 만약 목적지까지 도달하지 못하면 인터넷 상에서 계속 떠돌아다닐 수 있기에 이 필드가 있음.
    - 프로토콜: IP 계층 위에 존재하는 상위 프로토콜이 무엇인지. TCP인지 UDP인지..
    - 체크섬: 해더 부분 요류 검사. (데이터 검사 안함.)

### 6-1. IP주소와 서브넷

- ip주소: 32bit로 이루어진 인터넷상 컴퓨터의 주소
  - 8bit씩 쪼개서 10진수 숫자로 표기하고 점으로 구분. 이것을 DDN(Dotted Decimal Notaion)이라고 부름.(ex. 127.12.8.1)

- Classfull addresssing
  - ip주소는 클래스 A, B, C, D, E로 나뉜다. 규모가 크면 A 작으면 C 이런식이다.
  - ip주소의 첫번째 byte로 구분한다. 클래스A는 0으로 시작한다. 그래서 00000000 ~ 01111111까지다. 10진수로는 0부터 127까지다.
  - 클래스 B는 10으로 시작, 클래스 C는 110으로 시작, 클래스 D는 1110, 클래스E는 1111로 시작.
  - 정리하면
    - 클래스A: 네트워크 관련 부분(netid)이 1byte, 호스트 3byte 
    - 클래스B: netid 2byte, hostid 2byte
    - 클래스C: netid 3bte, hostid 1byte
    - 클래스D: multicast address
    - 클래스E: reserved for future use

- 서브넷
  - hostid의 일부분을 식별하게 좋게 사용해서 ip를 할당. ip만 봐도 어디 층인지 혹은 어디 부서의 컴퓨터인지 알 수 있도록 하기 위함.

### 6-2. 가변길이 주소

- 가변길이 주소지정(Classless addressing)
  - 필요한 만큼 ip주소를 효율적으로 할당

### 7-1. DHCP와 NAT

- DHCP(Dynamic Host Configuration Protocol)
  - IP주소를 할당해주는 프로토콜. IP주소를 얘가 할당해줌.
  - 정적으로 할당할수도 있고, 동적으로 할당할수도 있음.
  - 정적으로 할당한다는 건 "이 컴퓨터는 이 IP만 할당한다."는 것이고 동적으로 할당하는 건 그때그때 달라질 수 있다는 것이다.

- NAT(Network Address Translation)
  - 공인 IP주소의 수가 부족. 32bit밖에 안되니까 점점 모자라져서 확장해야겠다는 생각을 함.
  - 외부적으로는 원래 IP를 쓰고(공인IP), 내부적으로는 우리끼리 겹쳐도 상관없는 IP를 사용(비공인IP/사설IP)
  - 3개의 주소 세트를 개인 주소로 정해 놓음. 오직 내부적으로만 쓰는 IP
    - 10.0.0.0 ~ 10.255.255.255
    - 172.16.0.0 ~ 172.31.255.255
    - 192.168.0.0 ~ 192.168.255.255
  - 내부적으로만 이 IP들을 쓰고 외부로 나갈 때는 변환해서 쓰는데, 이 변환하는 기술이 NAT임.

### 7-2. 주소 매핑과 에러 보고

- 주소 매핑
  - LAN에서 사용하는 주소인 MAC 주소가 있고 인터넷에서 사용하는 IP주소가 있음.
  - 이더넷 프레임 포맷에 앞에는 목적지 주소가 있음. MAC 주소가 거기에 들어가 있어야하는데.. 보내는 사람 입장에서는 상대 MAC 주소를 알리가 없음. 모르면 물어봐야 함. 그걸 주소 매핑이라 함.
  - 즉 다음과 같이 연결되어야 메시지를 주고 받을 수 있음.
    - 내 IP - 내 LAN카드 MAC주소 - 상대방 MAC 주소 - 상대방 IP 
  - 주소 매핑에는 정적 매핑과 동적 매핑이 있음
    - 정적 매핑: IP주소와 MAC주소를 연결하는 테이블을 고정해서 생성. 현실적 불가능.
    - 동적 매핑: IP주소 바뀔 수 있음. LAN카드 바꾸면 MAC주소도 바뀜. 이러한 문제를 해결하기 위한 동적 매핑.
      - ARP(Address Resolution Protocol): IP주소는 아는데 MAC 주소를 알아야겠을 때 이 프로토콜이 사용됨.
      - RARP(Reversed ARP): MAC 주소는 아는데 IP를 모름. 지금은 거의 사용하지 않음. DHCP가 사용.

- ARP의 동작
  - 그냥 브로드캐스팅해버림. "이 IP가지고 있은 이더넷 주소 아는 사람?" 하면 컴퓨터들이 받음. 그럼 해당되는 컴퓨터가 송신자에게 유니케스트(1:1 통신)로 알려줌. 그럼 "아 이 IP는 MAC주소가 이거구나"하고 캐시해놓음. 이게 ARP 동작 과정.

- ICMP(에러보고, Internet Control Message Protocol)
  - IP의 문제를 보완하기 위함
  - IP는 에러제어와 관리기능이 부족. 헤더만 체크하고 문제있으면 버리니까.. 근데 또 버리고 상대 송신자에게 버렸다고 알려주지도 않음. 이런걸 ICMP가 보완해줌.
  - 에러 보고 기능
    - 목적지 도달 불가(Destination Unreachable): 패킷 패기했다.
    - 송신지 조절(Source Quench): 너무 혼잡하다. 수도꼭지 조절하듯.
    - 시간 초과(Time Exceeded): 야 다음 패킷 안와. 그냥 버린다.
    - 파라미터 문제(Parameter Problem): 야 이거 상태 이상해. 버린다.
    - 경로 재설정(Redirection): 컴퓨터 LAN 안에 여러 라우터가 있는데, 컴퓨터 A는 디폴트 게이트웨이로서 설정해놓는 라우터가 있음. 예를 들어 R1이라는 라우터가 컴퓨터한테 "앞으로 이 목적지에 대한 데이터는 나 말고 쟤 R2한테 보내"라고 경로를 재설정해주는게 리디렉션.
  - 관리 기능(질의 응답 Query): 잘 살아있냐? 고 물어보는 것.
    - 에코 요청/응답: Ping
    - 타임스탬프 요청/응답
    - 주소마스크 요청/응답
    - 라우터 요청/응답

### 8-1. 패킷의 전달

- 라우팅에 관한 이야기임.

- 패킷의 처리
  - 송신자의 네트워크 계층은 패킷을 생성(헤더에 송신자의 주소, 수신자의 주소)
  - 어느 경로로 가는게 가장 좋음? 이걸 정할 때 '라우팅 테이블'을 참조
  - 그래서 스위치나 라우터가 라우팅 테이블을 보고 패킷을 라우팅함.

- 패킷의 전달
  - next hop: A가 B로 패킷을 보낼 때 라우팅 테이블에 모든 걸 적을 필요는 없다. 목적지 주소와 next hop만 필요하다. 즉 next hop으로 가면 걔가 목적지까지 보내줄꺼야. 라는 것이다. 그러면 알아서 간다. 그럼 그 다음 장치가 정해놓은 장치로 가다보면 결국 B로 간다.
  - 네트워크 주소 명시: 동일한 네트워크에 연결된 컴퓨터들을 하나하나 모두 명시하는 것이 아니라 목적지 네트워크 주소만 명시. 그래야 라우팅 테이블이 절약되니까.
  - 호스트 주소 명시: 어떤 컴퓨터에 대해서는 특정 라우터를 거쳤으면 좋겠어서 명시하는 경우. 
  - 디퐅트 지정: PC방 같은 경우, 나갈곳은 단 하나임. 기본 지정해놓음.

### 8-2. 라우팅 프로토콜과 거리벡터 라우팅

- 라우팅
  - 라우팅이란 경로 설정! 송신지에서 목적지로 가는 경로가 여러 개가 있을텐데, 그 중에 맞는 경로를 하나 정하는 것을 라우팅이라 함. 그리고 이 라우팅을 하는 장치를 라우터라고 하고. 라우터들은 라우팅 프로토콜을 이용해서 라우팅 테이블을 만듦.
  - 라우팅 테이블은 프로토콜 대로 만들겠지만 사람이 직접 등록할 수도 있음. 이것을 정적 라우팅 (static 라우팅)이라고 함. 하지만 이건 일반적인 건 아니고, 보통은 동적 라우팅임.
  - 동적라우팅: 라우팅 테이블엔 최소 두개의 엔트리가 있음. 목적지 주소와 nexthop. 이게 새로 추가되었다가 삭제되었다가 하는 것임... 누가? 라우팅 프로토콜대로 동적으로 엔트리를 넣었다가 뺐다가 함.

- AS(Autonomous System): 자율 시스템
  - 라우터들은 라우팅 테이블을 서로 주고 받음. 그래야 서로 효율적으로 라우팅을 할 수 있기에. 근데 전 세계 모든 라우터들이 정보를 주고 받는 건 말이 안됨. 영역이 제한되어 있어야 함. 그걸 가능케 하는게 AS. 그래서 라우터들은 AS 번호라는 것이 있고.. 이 번호가 같은 라우터들끼리만 라우팅 정보를 서로 주고 받음.
  - 그래서 인터넷은 사실상 AS들의 모임임.
  - AS 내부의 라우팅 정보를 주고 받는 프로토콜은 Interior Gateway Protocol 줄여서, IGP라고 함. AS 간의 주고 받는 건, 외부에서 주고 받는 것이니, Exterior Gateway Protocol 라고 함.
  - IGP는 RIP, OSPF 등등 여러개 있는데 알빠아님. 내부에서 하는거 아무거나 쓰면 됨. 근데 EGP는 하나로 정해져 있음. 바로 BGP임.
  - 라우팅 프로토콜
    - intradomain(내부): RIP(거리백터), OSPF(링크상태)
    - interdomain(외부): BGP(경로백터)

- 거리백터 알고리즘: 최적의 경로를 최단 거리로 나타내는 것을 찾는 알고리즘.

### 9-1. 링크상태 라우팅과 경로벡터 라우팅

- 링크 상태 라우팅 (Link State Routing)
  - 모든 노드가 전체 네트워크에 대한 구성도를 만들어서 경로를 구함.
  - 그래서 모든 노드가 전체 구성도를 파악한 상태에서,
  - 나를 기준으로 최종 목적지까지 가는 베스트 경로를 선택하는 라우팅.
  - (링크 상태가 끊어지거나 변경되면 다시 구성도를 그려야함)
  - OSPF (Open Shortest Path First)
    - 링크 상태 라우팅의 대표적인 라우팅

- 경로 벡터 라우팅 (Path Vector Routing)
  - 도메인 내에서는 거리백터나 링크상태를 사용하고, 도메인 간에는 경로벡터 사용
  - 경로를 다 명시함. 보통은 next-hop만 명시하는데 얘는 다 명시함.
  - 이걸 사용하는 프로토콜이 BGP4
  - 이걸 왜함? 인터넷은 최적의 경로를 명시하기 때문에 한국 학교 A에서 한국 학교 B로 가는 데도 네트워크 상 미국을 거쳐서 가는 경우도 있음. (실제로 있었음) 근데 이게 말이 안됨. 다른 나라, 혹은 다른 회사를 거쳐가는 것 자체가 말이 안됨. 그래서 경로를 다 명시하면 다 보이니까 미국으로 가거나 다른 회사를 거쳐가거나 하는 행위를 막을 수 있음. 
  - 예를 들어, AS12로 갔  다가 AS15로 간다. 고 명시됨.

### 9-2. 멀티캐스팅

- 용어
  - 유니캐스팅: 송신지와 목적지가 하나씩.
  - 브로드캐스팅: 송신지는 하나, 목적지는 누구나
  - 멀티캐스팅: 목적지가 그룹에 속한 여러개

- IGMP(Internet Group Management Protocol)
  - 그룹에 속한 시스템들의 가입과 탈퇴를 관리
  - IGMP3 메시지
    - 라우터가 컴퓨터한테 query 보냄. 잘 살아있니? 회의 참여중이니?
    - 그럼 컴퓨터가 report 보냄. 잘 있어요. 참여중요.
    - 라우터는 report를 못받으면 그룹에 해당 컴퓨터 제거해버림.

- 멀티캐스팅 라우팅
  - 유니캐스팅 라우팅에선 한 목적지에 대한 하나의 최적경로를 갖음.
  - 근데 멀티캐스팅 라우팅에선 각 그룹에 대해 각각의 최적의 경로를 갖음.

### 10-1. 전송 프로토콜과 UDP

- 프로세스 간의 통신
  - 데이터링크 계층은 이웃한 두 노드 사이의 프레임 전달에 관여. (Node to Node Delivery)
    - 인터넷을 이루는 많은 노드 간에는 주로 데이터링크 계층이 많이 관장된다. 1과 0이 오고가는 것에 있어 에러제어가 다른것들 보다 중요하기 때문.
  - 네트워크 계층은 두 호스트 사이의 패킷 전달에 관여.
    - 여러 노드를 거친 최종 목적지와 처음의 송신자 사이에 정보를 교환하는 관점.(Host to Host Delivery)
    - 내 컴퓨터와 저 사람의 컴퓨터 즉, 호스트와 호스트간에 어떤 노드를 거쳐야 가장 좋은 경로냐를 따지는 라우팅 등이 네트워크 계층에서 핵심적인 기능이다.
  - 수송(트랜스포트) 계층은 프로세스 사이의 메시지 전달에 관여 (Process to Process Deilvery)
    - 내 컴퓨터와 쟤 컴퓨터 간 즉, 호스트와 호스트가 아니라. 그보다 더 안으로 파고들면, 프로세스가 있음. 내 컴퓨터의 프로세스와 쟤 컴퓨터의 프로세스 간의 통신에 관심을 갖는 계층이 transport 계층.
    - 노드와 노드 사이 상대방을 결정하려면 MAC 주소를 알아야 했고, 인터넷의 붙어있는 마지막 컴퓨터를 식별하려면 IP를 알아야 했고, 프로세스를 구변하려면 포트를 알아야 한다. 
    - TCP, UDP는 0 ~ 65535 (16bit) 까지 가능.
  - 클라이언트/서버 구성
    - 클라이언트는 필요할 때마다 켜서 서버에 요청하면 되는데
    - 서버는 24/7 프로그램이 돌아가야 한다. 그래서 서버 쪽에 해당하는 포트로서 붙여진 이름이 Well Known 포트다.
  - 포트 번호
    - IANA (Internet Assigned Numbers Authority)는 포트를 3개 영역으로 구분
      - Well-known ports: 0 ~ 1023
      - Registerd ports: 1024 ~ 49151 특정 응용을 위해 기업이 사용.
      - Dynamic ports: 49152 ~ 65535 통제되지 않음. 임시적임.

- UDP (User Datagram Protocol)
  - UDP의 Well-known ports 중에 53은 주로 DNS(Nameserver)로 쓰임. 그래서 UDP 53port 라고 하나 네임서버(도메인서버)라고 하나 동의어다. 
  - 또 많이 쓰는 UDP 포트 중에 161번, 162번인 SNMP가 있음.(Simple Network Management Protocol)
  - UDP는 8바이트의 고정된 헤더를 가지고 있음. 전체 8바이트 중에
    - 2바이트는 소스 포트 넘버
    - 2바이트는 목적지 포트 넘버
    - 2바이트는 전체 길이
    - 나머지 2바이트는 체크섬. 체크섬인데 이건 옵션. 헤더랑 데이터에 에러가 있는지 없는지를 검사하는건데, 데이터를 에러가 있나없나 확인하는 계층은 데이터링크 계층과 전송 계층밖에 없음. 근데 전송계층에서 UDP는 할수도있고 안할수도 있고.(체크섬이 옵션이니까.)
  - UDP의 사용
    - 간단한 요청-응답 서비스라면 적합한 프로토콜임.
    - UDP는 내부 흐름제어 및 에러제어를 안함. 근데 응용 프로토콜 레벨에서 그것을 한다면, UDP쓰는게 더 효율적.

### 10-12 TCP

- 기능
  - TCP 밑에 IP 가 있잖아. 근데 IP는 Unreliable함. 중간에 패킷이 손실되거나 순서가 바뀌거나 하는 문제가 생길 수도 있는데 TCP나 전송 계층에서 다시 복구해줌. 손실된 패킷이 있으면 다시 보낼 수 있도록 해주기도 하고. 순서가 바뀌어서 오면 원래 순서로 바꾸기도 하고.. 송신자가 보낸 바이트를 순서대로 받도록 해줌.
  - 프로세스간의 통신. 스트림 전달 서비스. 전이중(=Full Duplex) 통신(보내고 받고가 동시에 됨.) 등 제공.
  - 핸드쉐이크. 연결을 미리 해둠.
  - 포트번호
    - FTP 20, SMTP 25, SSH 22, Telnet 23, HTTP 80 등등.. 많이 씀.
  - 스트림 전달 서비스
    - TCP는 데이터를 바이트의 나열로 전달함. 효율성을 위해 여러 바이트를 블록으로 구성된 세그먼트로 만들어 전송. 바이트들이 쭈우욱 나열되어서 들어오는 것처럼 느끼게 만들어주는 서비스.
  - 흐름제어
    - 수신자가 메모리가 한 100바이트 정도 있으면, 송신자한테 "야 나 메모리없으니 100바이트만 보내 앞으로." 라고 해줌.
  - 잘 받았으면 ACK 주고 "ACk! = 인정! 다음 몇번째 바이트 보내!" 송신자는 ACK 안오면 다음 바이트 안주고 등의 과정이 있음.

- TCP의 메시지의 형태: 세그먼트
  - 헤더에는 2바이트의 소스 포트 주소, 2바이트의 목적지 포트 주소, 시퀀스 넘버(몇번째 세그먼트인지), ack, 윈도우사이즈, 체크섬, 어전트 포인터 등등.. 헤더는 20바ㅣ트고 옵션이 있으면 60바이트까지 존재할 수 있음.